{% extends "base.html" %}
{% block title %}Reportes de Inventario{% endblock %}
{% block content %}
<h1 class="mb-3">Reportes</h1>
<div class="row">
    <div class="col-lg-8 mb-4">
        <div class="card h-100"><div class="card-header"><i class="bi bi-bar-chart-fill me-2"></i>Top 5 Productos con Más Stock</div><div class="card-body"><canvas id="graficoStock"></canvas></div></div>
    </div>
    <div class="col-lg-4 mb-4">
        <div class="card h-100"><div class="card-header"><i class="bi bi-pie-chart-fill me-2"></i>Distribución por Marca</div><div class="card-body"><canvas id="graficoMarcas"></canvas></div></div>
    </div>
</div>
<div class="card mt-2">
    <div class="card-header"><h2><i class="bi bi-file-earmark-spreadsheet me-2"></i>Exportar Datos</h2></div>
    <div class="card-body">
        <p class="text-muted">Genera un archivo CSV con todos los productos del inventario para su análisis.</p>
        <a href="{{ url_for('exportar_csv') }}" class="btn btn-success">Exportar Inventario a CSV</a>
    </div>
</div>
{% endblock %}
{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    Chart.defaults.color = '{{ get_flashed_messages | safe }}'; // Un truco para adaptar el color del texto de Chart.js
    const ctxStock=document.getElementById("graficoStock"),stockLabels=JSON.parse('{{ stock_labels|safe }}'),stockData=JSON.parse('{{ stock_data|safe }}');new Chart(ctxStock,{type:"bar",data:{labels:stockLabels,datasets:[{label:"Cantidad en Stock",data:stockData,backgroundColor:"rgba(127, 90, 240, 0.8)",borderColor:"rgba(127, 90, 240, 1)",borderWidth:1}]},options:{indexAxis:"y",scales:{x:{beginAtZero:!0}},responsive:!0,plugins:{legend:{display:!1}}}});
    const ctxMarcas=document.getElementById("graficoMarcas"),marcaLabels=JSON.parse('{{ marca_labels|safe }}'),marcaData=JSON.parse('{{ marca_data|safe }}');new Chart(ctxMarcas,{type:"doughnut",data:{labels:marcaLabels,datasets:[{label:"# de Productos",data:marcaData,backgroundColor:["#7f5af0","#2cb67d","#ffc107","#d63384","#6f42c1"],hoverOffset:4}]},options:{responsive:!0}});
</script>
{% endblock %}